<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paws Pet House - Quản lý Lịch hẹn</title>
    <link rel="stylesheet" href="QLLH-NV.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  </head>
  <body>
    <!-- Header ngang trên cùng -->
    <header class="site-header">
      <div class="logo">
        <img
          src="https://i.imgur.com/YpwJQhA.png"
          alt="Paw Logo"
          class="logo-icon" />
        PAWS PET HOUSE
      </div>
    </header>
    <div class="app-container">
      <aside class="sidebar">
        <nav class="nav-menu">
          <a href="QLDV.html"><i class="fas fa-cogs"></i> Quản lý dịch vụ</a>
          <a href="QLTK.html"><i class="fas fa-user"></i> Quản lý tài khoản</a>
          <a class="active" href="#"
            ><i class="fas fa-calendar-alt"></i> Quản lý lịch hẹn</a
          >
          <a href="QLTT.html"
            ><i class="fas fa-folder-open"></i> Quản lý thông tin</a
          >
        </nav>
      </aside>
      <div class="content-area">
        <div class="topbar">
          <span class="breadcrumb"
            >Trang chủ / <strong>Quản lý lịch hẹn</strong></span
          >
          <div class="user-admin">
            <img
              src="https://cdn-icons-png.flaticon.com/512/847/847969.png"
              alt="Avatar"
              class="avatar" />
            Admin
          </div>
        </div>
        <div class="table-container">
          <h3 class="table-title">DANH SÁCH LỊCH HẸN</h3>
          <div class="table-toolbar">
            <div class="toolbar-left">
              <div class="search-group">
                <input
                  type="text"
                  placeholder="Tìm kiếm"
                  class="search-box"
                  id="searchBox" />
                <button class="search-button" id="searchBtn">
                  <i class="fas fa-search"></i>
                </button>
              </div>
              <button class="filter-button">
                <i class="fas fa-filter"></i> Bộ lọc
                <i class="fas fa-caret-down"></i>
              </button>
              <div class="filter-panel" id="appointmentFilterPanel">
                <h4>BỘ LỌC LỊCH HẸN</h4>
                <div class="filter-group">
                  <label for="dateFromFilter">Từ ngày</label
                  ><input type="date" id="dateFromFilter" />
                </div>
                <div class="filter-group">
                  <label for="dateToFilter">Đến ngày</label
                  ><input type="date" id="dateToFilter" />
                </div>
                <div class="filter-group">
                  <label for="serviceFilter">Dịch vụ</label
                  ><select id="serviceFilter">
                    <option value="all">Tất cả dịch vụ</option>
                    <option value="Tắm rửa">Tắm rửa</option>
                    <option value="Nhuộm lông">Nhuộm lông</option>
                    <option value="Combo Spa">Combo Spa</option>
                  </select>
                </div>
                <div class="filter-actions">
                  <button class="btn-reset-filter">Đặt lại</button
                  ><button class="btn-apply-filter">Áp dụng</button>
                </div>
              </div>
            </div>
            <button class="add-button">
              <i class="fas fa-plus white-icon"></i> Thêm mới
            </button>
          </div>
          <table class="appointment-table">
            <thead>
              <tr>
                <th>Mã LH</th>
                <th>Ngày</th>
                <th>Giờ</th>
                <th>Khách hàng</th>
                <th>SDT</th>
                <th>Thú cưng</th>
                <th>Dịch vụ</th>
                <th>Tác vụ</th>
              </tr>
            </thead>
            <tbody id="appointmentBody"></tbody>
          </table>
          <div class="pagination">
            <button id="firstPage">«</button>
            <button id="prevPage">‹</button>
            <span
              >Trang
              <input
                type="number"
                id="currentPage"
                class="page-input"
                min="1" />
              / <span id="totalPages">1</span></span
            >
            <button id="nextPage">›</button>
            <button id="lastPage">»</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modals & Popup -->
    <div id="editModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-btn" onclick="closeEditModal()">&times;</span>
        <h3 id="modalTitle">Chỉnh sửa lịch hẹn</h3>
        <form id="editAppointmentForm" data-mode="edit">
          <label>Khách hàng:</label
          ><input type="text" id="customerName" required /> <label>SĐT:</label
          ><input type="text" id="phoneNumber" required />
          <label>Ngày hẹn:</label
          ><input type="date" id="appointmentDate" required />
          <label>Giờ:</label
          ><select id="appointmentTime" required>
            <option value="08:00">08:00</option>
            <option value="10:00">10:00</option>
            <option value="14:00">14:00</option>
            <option value="16:00">16:00</option>
          </select>
          <label>Thú cưng:</label><input type="text" id="petName" required />
          <label>Dịch vụ:</label
          ><select id="service" required>
            <option value="Tắm rửa">Tắm rửa</option>
            <option value="Nhuộm lông">Nhuộm lông</option>
            <option value="Combo Spa">Combo Spa</option>
          </select>
          <button type="submit" class="save-button" id="modalSubmitButton">
            Lưu thay đổi
          </button>
        </form>
      </div>
    </div>

    <div id="invoiceModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-btn" onclick="closeInvoiceModal()">&times;</span>
        <h3>Xuất Hóa Đơn</h3>
        <div id="invoice-details"></div>
        <button onclick="processInvoice()" class="save-button">
          Xuất hóa đơn
        </button>
      </div>
    </div>

    <div id="cancel-popup" class="popup-overlay" style="display: none">
      <div class="popup-box">
        <div class="popup-header">HỦY LỊCH HẸN</div>
        <div class="popup-body">
          <div class="popup-content">
            <img
              src="https://png.pngtree.com/png-vector/20230314/ourmid/pngtree-hazard-icon-vector-png-image_6647993.png"
              class="warning-icon" />
            <p>Bạn có chắc chắn muốn hủy?</p>
          </div>
          <div class="popup-actions">
            <button class="btn btn-confirm">Xác nhận</button
            ><button class="btn btn-cancel">Quay lại</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const appointments = [
        {
          id: "LH001",
          date: "2025-05-15",
          time: "10:00",
          customer: "Phạm Hoàng Hưng",
          phone: "0842672987",
          pet: "Bánh bao",
          service: "Tắm rửa",
        },
        {
          id: "LH002",
          date: "2025-05-16",
          time: "14:00",
          customer: "Nguyễn Văn A",
          phone: "0912345678",
          pet: "Miu",
          service: "Nhuộm lông",
        },
        {
          id: "LH003",
          date: "2025-05-17",
          time: "08:00",
          customer: "Trần Thị B",
          phone: "0987654321",
          pet: "Poodle",
          service: "Combo Spa",
        },
      ];
      const pageSize = 10;
      let currentPage = 1;
      const totalPages = Math.ceil(appointments.length / pageSize);
      const body = document.getElementById("appointmentBody");
      const cp = document.getElementById("currentPage");
      const tp = document.getElementById("totalPages");
      const first = document.getElementById("firstPage"),
        prev = document.getElementById("prevPage"),
        next = document.getElementById("nextPage"),
        last = document.getElementById("lastPage");
      tp.innerText = totalPages;
      cp.value = currentPage;
      function render(page) {
        body.innerHTML = "";
        let start = (page - 1) * pageSize;
        appointments.slice(start, start + pageSize).forEach((a) => {
          let tr = document.createElement("tr");
          tr.innerHTML = `<td>${a.id}</td><td>${a.date}</td><td>${a.time}</td><td>${a.customer}</td><td>${a.phone}</td><td>${a.pet}</td><td>${a.service}</td><td><button class='icon-button edit-button' onclick='openEditModal(this)'><i class='fas fa-edit'></i></button><button class='icon-button invoice-button' onclick='openInvoiceModal(this)'><i class='fas fa-file-invoice'></i></button><button class='icon-button delete-button' onclick='showDeletePopup()'><i class='fas fa-times'></i></button></td>`;
          body.appendChild(tr);
        });
        cp.value = page;
        first.disabled = page === 1;
        prev.disabled = page === 1;
        next.disabled = page === totalPages;
        last.disabled = page === totalPages;
      }
      first.onclick = () => {
        currentPage = 1;
        render(currentPage);
      };
      prev.onclick = () => {
        if (currentPage > 1) currentPage--;
        render(currentPage);
      };
      next.onclick = () => {
        if (currentPage < totalPages) currentPage++;
        render(currentPage);
      };
      last.onclick = () => {
        currentPage = totalPages;
        render(currentPage);
      };
      cp.onchange = () => {
        let p = parseInt(cp.value);
        if (p >= 1 && p <= totalPages) {
          currentPage = p;
          render(p);
        } else cp.value = currentPage;
      };
      // Initial
      render(currentPage);
      // Filter panel
      const filterBtn = document.querySelector(".filter-button");
      const panel = document.getElementById("appointmentFilterPanel");
      filterBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        panel.classList.toggle("active");
      });
      document.addEventListener("click", () =>
        panel.classList.remove("active")
      );
      panel.addEventListener("click", (e) => e.stopPropagation());
      panel.querySelector(".btn-apply-filter").addEventListener("click", () => {
        let rows = Array.from(body.querySelectorAll("tr"));
        let from = panel.querySelector("#dateFromFilter").value,
          to = panel.querySelector("#dateToFilter").value,
          svc = panel.querySelector("#serviceFilter").value;
        rows.forEach((r) => {
          let d = r.cells[1].innerText;
          let match =
            (!from || d >= from) &&
            (!to || d <= to) &&
            (svc === "all" || r.cells[6].innerText === svc);
          r.style.display = match ? "" : "none";
        });
        panel.classList.remove("active");
      });
      panel.querySelector(".btn-reset-filter").addEventListener("click", () => {
        let rows = Array.from(body.querySelectorAll("tr"));
        panel.querySelector("#dateFromFilter").value = "";
        panel.querySelector("#dateToFilter").value = "";
        panel.querySelector("#serviceFilter").value = "all";
        rows.forEach((r) => (r.style.display = ""));
        panel.classList.remove("active");
      });
      // Modal & popup functions
      function openEditModal(btn) {
        let r = btn.closest("tr");
        let get = (i) => r.children[i].innerText;
        document.getElementById("appointmentDate").value = get(1);
        document.getElementById("appointmentTime").value = get(2);
        document.getElementById("customerName").value = get(3);
        document.getElementById("phoneNumber").value = get(4);
        document.getElementById("petName").value = get(5);
        document.getElementById("service").value = get(6);
        document.getElementById("modalTitle").innerText = "Chỉnh sửa lịch hẹn";
        document.getElementById("modalSubmitButton").innerText = "Lưu thay đổi";
        document.getElementById("editAppointmentForm").dataset.mode = "edit";
        document.getElementById("editModal").style.display = "flex";
      }
      function openAddModal() {
        let form = document.getElementById("editAppointmentForm");
        form.reset();
        document.getElementById("modalTitle").innerText = "Thêm mới lịch hẹn";
        document.getElementById("modalSubmitButton").innerText =
          "Thêm lịch hẹn";
        form.dataset.mode = "add";
        document.getElementById("editModal").style.display = "flex";
      }
      document
        .querySelector(".add-button")
        .addEventListener("click", openAddModal);
      function closeEditModal() {
        document.getElementById("editModal").style.display = "none";
      }
      function openInvoiceModal(btn) {
        let r = btn.closest("tr");
        document.getElementById(
          "invoice-details"
        ).innerHTML = `<p><strong>Mã LH:</strong> ${r.cells[0].innerText}</p><p><strong>Khách:</strong> ${r.cells[3].innerText}</p><p><strong>Thú cưng:</strong> ${r.cells[5].innerText}</p><p><strong>Dịch vụ:</strong> ${r.cells[6].innerText}</p>`;
        document.getElementById("invoiceModal").style.display = "flex";
      }
      function closeInvoiceModal() {
        document.getElementById("invoiceModal").style.display = "none";
      }
      function processInvoice() {
        alert("Xuất hóa đơn xong");
        closeInvoiceModal();
      }
      function showDeletePopup() {
        document.getElementById("cancel-popup").style.display = "flex";
      }
      document
        .querySelector(".btn-cancel")
        .addEventListener(
          "click",
          () => (document.getElementById("cancel-popup").style.display = "none")
        );
      document.querySelector(".btn-confirm").addEventListener("click", () => {
        document.getElementById("cancel-popup").style.display = "none";
        alert("Đã hủy lịch hẹn");
      });
    </script>
  </body>
</html>
